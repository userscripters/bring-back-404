// ==UserScript==
// @author          Oleg Valter <oleg.a.valter@gmail.com>
// @description     Brings back 404 pages to Stack Exchange network
// @grant           none
// @homepage        https://github.com/userscripters/bring-back-404#readme
// @match           https://*.askubuntu.com/*
// @match           https://*.serverfault.com/*
// @match           https://*.stackapps.com/*
// @match           https://*.stackexchange.com/*
// @match           https://*.stackoverflow.com/*
// @match           https://*.superuser.com/*
// @name            bring-back-404
// @namespace       userscripters
// @source          git+https://github.com/userscripters/bring-back-404.git
// @supportURL      https://github.com/userscripters/bring-back-404/issues
// @version         0.2.0
// ==/UserScript==

"use strict";!function(i,e){var t=(n.clear=function(){var e=this.storage,t=this.prefix;e.removeItem(t)},n.open=function(){var e=this.storage,t=this.prefix,t=e.getItem(t);return t?JSON.parse(t):{}},n.load=function(e,t){e=n.open()[e];return void 0!==e?e:t},n.save=function(e,t){var i=this.storage,s=this.prefix,a=n.open();a[e]=t,i.setItem(s,JSON.stringify(a))},n.toggle=function(e){return n.save(e,!n.load(e))},n.remove=function(e){var t=this.prefix,t=this.load(t,{});return delete t[e],n.save(e,t)},n.storage=localStorage,n.prefix="bring-back-404",n);function n(){}var s=[{site:"stackoverflow",imageURL:"https://i.stack.imgur.com/okzBE.png"},{site:"meta.stackoverflow",imageURL:"https://i.stack.imgur.com/0i2to.png"},{site:"askubuntu",imageURL:"https://i.stack.imgur.com/KopoQ.png"},{site:"superuser",imageURL:"https://i.stack.imgur.com/hMfYx.png"},{site:"english.stackexchange",imageURL:"https://i.stack.imgur.com/cQLRt.png"},{site:"codereview.stackexchange",imageURL:"https://i.stack.imgur.com/R4Tgd.png"},{site:"unix.stackexchange",imageURL:"https://i.stack.imgur.com/XQRh5.png"},{site:"scifi.stackexchange",imageURL:"https://i.stack.imgur.com/UR35t.png"},{site:"math.stackexchange",imageURL:"https://i.stack.imgur.com/bHpU1.png"},{site:"serverfault",imageURL:"https://i.stack.imgur.com/W7VMk.png"},{site:"apple.stackexchange",imageURL:"https://i.stack.imgur.com/fCIaP.png"},{site:"stats.stackexchange",imageURL:"https://i.stack.imgur.com/BqaS0.png"},{site:"gaming.stackexchange",imageURL:"https://i.stack.imgur.com/C4jC1.png"},{site:"judaism.stackexchange",imageURL:"https://i.stack.imgur.com/048MA.png"},{site:"webmasters.stackexchange",imageURL:"https://i.stack.imgur.com/Z8Y2o.png"},{site:"crypto.stackexchange",imageURL:"https://i.stack.imgur.com/2hyIe.png"},{site:"cooking.stackexchange",imageURL:"https://i.stack.imgur.com/kSX5n.png"},{site:"diy.stackexchange",imageURL:"https://i.stack.imgur.com/C4P5L.png"}];t.load("overrides",[]).forEach(function(t){var e=s.find(function(e){return e.site===t.site});if(!e)return s.push(t);Object.assign(e,t)});var a=e.hostname.split(".").slice(0,-1).join("."),e=s.find(function(e){return e.site===a});if(!e)return console.debug("not on supported site: "+a);var e=e.imageURL,c=i.createElement("img");c.src=e,c.alt="Page not found",c.decoding="async",c.width=250,c.style.display="none",c.addEventListener("error",function(){return console.debug("failed to load 404 image on "+a)}),c.addEventListener("load",function(){var e=i.getElementById("content");if(!e)return console.debug("missing content modal");var t=e.querySelector("svg.spotAlertXL");if(!t)return console.debug("missing 404 image");t.replaceWith(c),c.style.display="unset";e=e.querySelector("h1");if(!e)return console.debug("missing 404 header");e.classList.remove("mt48");e=e.closest(".d-flex");if(!e)return console.debug("404 content does't use Flexbox");e.classList.replace("ai-start","ai-center")}),i.body.append(c)}((window,document),location);