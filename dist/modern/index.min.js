// ==UserScript==
// @author          Oleg Valter <oleg.a.valter@gmail.com>
// @description     Brings back 404 pages to Stack Exchange network
// @grant           none
// @homepage        https://github.com/userscripters/bring-back-404#readme
// @match           https://*.askubuntu.com/*
// @match           https://*.serverfault.com/*
// @match           https://*.stackapps.com/*
// @match           https://*.stackexchange.com/*
// @match           https://*.stackoverflow.com/*
// @match           https://*.superuser.com/*
// @name            bring-back-404
// @namespace       userscripters
// @source          git+https://github.com/userscripters/bring-back-404.git
// @supportURL      https://github.com/userscripters/bring-back-404/issues
// @version         0.2.0
// ==/UserScript==

"use strict";((a,t)=>{class c{static clear(){const{storage:t,prefix:e}=this;t.removeItem(e)}static open(){const{storage:t,prefix:e}=this;var s=t.getItem(e);return s?JSON.parse(s):{}}static load(t,e){t=c.open()[t];return void 0!==t?t:e}static save(t,e){const{storage:s,prefix:i}=this,a=c.open();a[t]=e,s.setItem(i,JSON.stringify(a))}static toggle(t){return c.save(t,!c.load(t))}static remove(t){var e=this["prefix"];const s=this.load(e,{});return delete s[t],c.save(t,s)}}c.storage=localStorage,c.prefix="bring-back-404";const s=[{site:"stackoverflow",imageURL:"https://i.stack.imgur.com/okzBE.png"},{site:"meta.stackoverflow",imageURL:"https://i.stack.imgur.com/0i2to.png"},{site:"askubuntu",imageURL:"https://i.stack.imgur.com/KopoQ.png"},{site:"superuser",imageURL:"https://i.stack.imgur.com/hMfYx.png"},{site:"english.stackexchange",imageURL:"https://i.stack.imgur.com/cQLRt.png"},{site:"codereview.stackexchange",imageURL:"https://i.stack.imgur.com/R4Tgd.png"},{site:"unix.stackexchange",imageURL:"https://i.stack.imgur.com/XQRh5.png"},{site:"scifi.stackexchange",imageURL:"https://i.stack.imgur.com/UR35t.png"},{site:"math.stackexchange",imageURL:"https://i.stack.imgur.com/bHpU1.png"},{site:"serverfault",imageURL:"https://i.stack.imgur.com/W7VMk.png"},{site:"apple.stackexchange",imageURL:"https://i.stack.imgur.com/fCIaP.png"},{site:"stats.stackexchange",imageURL:"https://i.stack.imgur.com/BqaS0.png"},{site:"gaming.stackexchange",imageURL:"https://i.stack.imgur.com/C4jC1.png"},{site:"judaism.stackexchange",imageURL:"https://i.stack.imgur.com/048MA.png"},{site:"webmasters.stackexchange",imageURL:"https://i.stack.imgur.com/Z8Y2o.png"},{site:"crypto.stackexchange",imageURL:"https://i.stack.imgur.com/2hyIe.png"},{site:"cooking.stackexchange",imageURL:"https://i.stack.imgur.com/kSX5n.png"},{site:"diy.stackexchange",imageURL:"https://i.stack.imgur.com/C4P5L.png"}],e=c.load("overrides",[]);e.forEach(e=>{var t=s.find(({site:t})=>t===e.site);if(!t)return s.push(e);Object.assign(t,e)});const i=t["hostname"],n=i.split(".").slice(0,-1).join(".");t=s.find(({site:t})=>t===n);if(!t)return console.debug(`not on supported site: ${n}`);var t=t["imageURL"];const o=a.createElement("img");o.src=t,o.alt="Page not found",o.decoding="async",o.width=250,o.style.display="none",o.addEventListener("error",()=>console.debug(`failed to load 404 image on ${n}`)),o.addEventListener("load",()=>{const t=a.getElementById("content");if(!t)return console.debug("missing content modal");const e=t.querySelector("svg.spotAlertXL");if(!e)return console.debug("missing 404 image");e.replaceWith(o),o.style.display="unset";const s=t.querySelector("h1");if(!s)return console.debug("missing 404 header");s.classList.remove("mt48");const i=s.closest(".d-flex");if(!i)return console.debug("404 content does't use Flexbox");i.classList.replace("ai-start","ai-center")}),a.body.append(o)})((window,document),location);